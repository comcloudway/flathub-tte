---
app-id: "page.codeberg.terratactician_expandoria.game"
runtime: "org.freedesktop.Platform"
runtime-version: "24.08"
sdk: "org.freedesktop.Sdk"
sdk-extensions:
  - "org.freedesktop.Sdk.Extension.rust-stable"
command: "terratactician-expandoria"
build-options:
  env:
    CARGO_HOME: "/run/build/terratactician_expandoria/cargo"
    TTE_BUILD_ASSETS_DIR: "/app/share/terratactician_expandoria/assets"
  append-path: "/usr/lib/sdk/rust-stable/bin"
finish-args:
  # X11 + XShm access
  - "--share=ipc"
  - "--socket=fallback-x11"
  # Wayland access
  - "--socket=wayland"
  # GPU acceleration if needed
  - "--device=dri"
  # Sound output
  - "--socket=pulseaudio"
  # Access to Input devices
  # (will only work on flatpak >= 1.15.6 (not yet stable)
  # - "--device=input"
  # simply request all input devices for now
  - "--device=all"
  # Allow access to .local/share
  - "--filesystem=xdg-data"
  # Needs to talk to the network:
  # required after #131 (https://codeberg.org/terratactician_expandoria/game/pulls/131) is merged
  #- "--share=network"
cleanup:
  - "/include"
  - "/lib/pkgconfig"
  - "/man"
  - "/share/doc"
  - "/share/man"
  - "/share/pkgconfig"
  - "*.la"
  - "*.a"
modules:
  - name: "terratactician_expandoria"
    buildsystem: "simple"
    build-commands:
      # build the cargo project
      - "cargo --offline fetch --manifest-path Cargo.toml --verbose"
      - "cargo --offline build --release --verbose -F custom-assets-path"
      # install binary
      - "install -Dm755 ./target/release/terratactician-expandoria -t /app/bin/"
      # install desktop file
      - "install -Dm755 ./page.codeberg.terratactician_expandoria.game.desktop /app/share/applications/page.codeberg.terratactician_expandoria.game.desktop"
      # install metainfo file
      - "install -Dm755 ./page.codeberg.terratactician_expandoria.game.metainfo.xml /app/share/metainfo/page.codeberg.terratactician_expandoria.game.metainfo.xml"
      # install icon
      - "install -Dm755 ./assets/icons/app-icon.png /app/share/icons/hicolor/512x512/apps/page.codeberg.terratactician_expandoria.game.png"
      # install assets
      - "mkdir -p /app/share/terratactician_expandoria"
      - "cp assets -r /app/share/terratactician_expandoria/"
    sources:
      ########################################
      # GAME SOURCE
      # choose one of the following sources
      # 1. local source directory (useful for development)
      #- type: "dir"
      #  path: "../game"
      # 2. upstream source code version (useful to build stable versions)
      #- type: "git"
      #  url: "https://codeberg.org/terratactician_expandoria/game"
      #  tag: "0.1.0"
      # 3. upstream source code branch (useful to build nightly versions
      - type: "git"
        url: "https://codeberg.org/terratactician_expandoria/game"
        branch: "main"
      ########################################
      # ADDITIONAL SOURCES
      # cargo build dependencies
      - "cargo-sources.json"
      # desktop file
      - type: "file"
        path: "./page.codeberg.terratactician_expandoria.game.desktop"
      # metainfo file
      - type: "file"
        path: "./page.codeberg.terratactician_expandoria.game.metainfo.xml"
